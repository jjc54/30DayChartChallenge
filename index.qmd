---
title: "30DayChartChallenge"
subtitle: "First data viz challenge - go easy on me"
author: Joshua J. Cook, M.S., ACRP-PM, CCRC
date: today
format: 
  html:
    other-links:
      - text: Website
        href: https://joshua-j-cook-portfolios.netlify.app/
      - text: GitHub
        href: https://github.com/jjc54
      - text: LinkedIn
        href: https://www.linkedin.com/in/joshua-j-cook-934075169/ 
theme: pulse
embed-resources: true
toc: true
---

# Information

[![](images/prompts.png){fig-align="center"}](https://github.com/30DayChartChallenge/Edition2024?tab=readme-ov-file)

[Post \| Feed \| LinkedIn](https://www.linkedin.com/feed/update/urn:li:activity:7180675688549511168/)

[30DayChartChallenge/Edition2024 (github.com)](https://github.com/30DayChartChallenge/Edition2024)

# Data

Charts in this challenge utilized a publicly available dataset that was extracted from the **Aggregate Analysis of ClinicalTrials.gov (AACT)** database ([AACT Database \| Clinical Trials Transformation Initiative (ctti-clinicaltrials.org)](https://aact.ctti-clinicaltrials.org/)). This dataset, `clinical_trials_fl`, was generated by querying the AACT database using open-source tools like R, RStudio, DBI, PostgreSQL, the tidyverse suite, and gt. Specifically, this dataset represents all the clinical trials registered and completed within the state of Florida of the United States between 23MAR2014-23MAR2024 (10 years).

```{r}
#| warning: false

clinical_trials_fl <- readRDS("data/query_results_clean_final_mesh.rds")
```

# Comparisons

### 1. Part-to-whole

Part-to-whole charts display individual pieces or segments of data that make up a whole. Common examples are pie charts and stacked bar charts. These visualizations aid in understanding proportions or percentages that contribute to the whole. For this today's example, we will visualize the proportion of conditions (using MeSH terms) that have been studied over the past 10 years in Florida. This visualize was inspired by the treemap by [Yobanny Sámano](https://twitter.com/ysamano28): [Treemap with annotations, labels and colors – the R Graph Gallery (r-graph-gallery.com)](https://r-graph-gallery.com/web-treemap-with-annotations-labels-and-colors.html).

```{r}
#| label: PartToWhole
#| warning: false

packages <- c("tidyverse", "treemapify", "RColorBrewer")

if (any(!sapply(packages, requireNamespace, quietly = TRUE))) {
  install.packages(packages[!sapply(packages, requireNamespace, quietly = TRUE)])
}

library(tidyverse)
library(treemapify)
library(RColorBrewer)

#str(clinical_trials_fl)

# Step 1: Calculate frequencies for each mesh_term
clinical_trials_freq <- clinical_trials_fl %>%
  filter(!is.na(mesh_term)) %>%
  count(mesh_term) %>%
  mutate(total = sum(n), Proportion = n / total) %>%
  ungroup()

# Step 2: Select the top 30 mesh_terms based on frequency
top_25_mesh_terms <- clinical_trials_freq %>%
  arrange(desc(n)) %>%
  top_n(25, n) %>%
  mutate(label = paste(mesh_term, " (", n, ")", sep = "")) # Creating a new column 'label' for treemap labels

# Step 3: Generate the treemap - ggplot2 style
# Get colors from the "Oranges" palette
# You can adjust the number of colors based on your data
colors <- brewer.pal(9, "Oranges")

ggplot(top_25_mesh_terms, aes(area = n, fill = Proportion, label = label)) +
  geom_treemap() +
  geom_treemap_text(colour = "black", place = "centre", grow = TRUE) +
  scale_fill_gradientn(colours = colors) + # Using "Oranges" palette
  labs(
    title = "Top 25 MeSH Terms for Clinical Trials in Florida",
    subtitle = "MeSH Term (n)",
    caption = "Data Source: Clinical Trials Transformation Initiative (CTTI)."
  ) +
  theme_minimal() +
  theme(plot.background = element_rect(fill = "white"),
        text = element_text(color = "#1E1D23"),
        plot.title = element_text(size = 18, face = "bold"),
        plot.caption = element_text(size = 10, color = "black"))

ggsave("chart_1.png", width = 16, height = 9, dpi = 300)
```
